%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% AGUJournalTemplate.tex: this template file is for articles formatted with LaTeX
%
% This file includes commands and instructions
% given in the order necessary to produce a final output that will
% satisfy AGU requirements, including customized APA reference formatting.
%
% You may copy this file and give it your
% article name, and enter your text.
%
%
% Step 1: Set the \documentclass
%
%

%% To submit your paper:
\documentclass[draft]{agujournal2019}
\usepackage{url} %this package should fix any errors with URLs in refs.
\usepackage{lineno}
\usepackage[inline]{trackchanges} %for better track changes. finalnew option will compile document with changes incorporated.
\usepackage{soul}
\linenumbers
%%%%%%%
% As of 2018 we recommend use of the TrackChanges package to mark revisions.
% The trackchanges package adds five new LaTeX commands:
%
%  \note[editor]{The note}
%  \annote[editor]{Text to annotate}{The note}
%  \add[editor]{Text to add}
%  \remove[editor]{Text to remove}
%  \change[editor]{Text to remove}{Text to add}
%
% complete documentation is here: http://trackchanges.sourceforge.net/
%%%%%%%
\addeditor{HW}

\draftfalse

\journalname{Journal of Advances in Modeling Earth Systems (JAMES)}

\usepackage{mathptmx}
\usepackage{array}
\usepackage{rotating}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}

\begin{document}

\title{Multi-fluids for Representing Sub-filter-scale Convection}

\authors
{
    Hilary Weller\affil{1}\thanks{Meteorology, University of Reading, UK}
    ,
    William McIntyre\affil{1}
    ,
    Daniel Shipley\affil{1}
    , and 
    Peter Clark\affil{1}
}

\affiliation{1}{Meteorology, University of Reading, UK}

\correspondingauthor{Hilary Weller}{h.weller@reading.ac.uk}

\begin{keypoints}
\item Multi-fluid modelling enables net mass transport by parameterised convection and non-equlibrium.
\item Multi-fluid modelling means a new dynamical core rather than a parameterisation for an existing core
\item Closure for the pressure difference between fluids and entrainment and detrainment are provided
\end{keypoints}

\begin{abstract}
Multi-fluid modelling is a promising new method of representing sub
and near grid-scale convection allowing for consistent and accurate
treatment of net mass transport by convection, non-equilibrium and
turbulence. The air is partitioned into convecting and non-convecting
fluids each with their own velocity, temperature and constituents
so that separate equations of motion can be solved for each fluid,
thus representing features that cannot be resolved in a single-fluid
at coarse resolution. 

This paper presents multi-fluid Boussinesq equations for representing
under resolved dry convection. We present a new model for entrainment
and detrainment based on divergence which leads to excellent representation
of the convective area fraction. Previous multi-fluid modelling of
convection has assumed that all fluids share the same pressure. We
show that this is a bad assumption and we propose and validate a model
for the pressure difference between the fluids based on divergence. 

Two vertical slice test cases are used to validate the multi-fluid
model; a buoyant rising bubble and radiative convective equilibrium
are simulated at high resolution and conditionally averaged based
on the sign of the vertical velocity. The multi-fluid model reproduces
the mean properties of the rising and falling fluids in a \change[HW]{single}{one} column. 
\end{abstract}

\section*{Plain Language Summary}
Clouds and buoyant convection are often smaller than the grid size in weather and climate prediction models but they are of central importance. Therefore their effects are parameterised -- their interactions with the larger scales are estimated based on properties of the larger scales. Convection parameterisations are a large source of error in models of the atmosphere despite decades of effort to improve them. An important assumption in most convection parameterisations is that convection moves heat and moisture upwards but not mass. This makes it much simpler to incorporate convection parameterisations into existing models. Multi-fluid modelling will enable mass transport by convection but the approach means a whole new atmospheric model rather than a stand alone routine that can be incorporated into an existing model. This paper provides some closures necessary for multi-fluid modelling and validation of the technique for two dimensional dry convection.

\section{Introduction}

Slow progress has been made improving the parameterisation of sub-grid-scale
convection since \citeA{AS74}, \citeA{Tied89}, \citeA{GR90} and \citeA{KF90}. Convection is still
one of the weakest aspects of large scale models of the atmosphere
\cite{HPB+14,SAB+13,ipcc41}. Improvements have been made \add[HW]{by} relaxing
the quasi-equilibrium assumption \cite{PR98,GG05,Par14}, including
stochasticity \cite{PC08} and allowing net mass transport by convection
\cite{KB08,MB19}. These developments have enabled limited simulation
in the grey zone, where convection is partially resolved. However
there are still systematic biases implying that improvements should
still be possible.

\citeA{TWV+18} proposed multi-fluid modelling of convection in order
to treat non-equilibrium and net mass transport correctly and consistently
with the same numerics and physics controlling thermals, the stable
environment and downdraught dynamics. \citeA{Yano14} derived similar
equations for multiple segments and showed how this is a generalisation
of the mass-flux formulation. The \citeA{TKP+18} ``extended eddy
diffusivity mass flux'' or extended EDMF scheme also uses similar
equations but \citeA{TKP+18}
\change[HW]{didn't propose a suitable numerical method for solving the equations.}
{only solve the equations in a single column without coupling to the continuity equation of a dynamical core.}
Multi-fluids promises big improvements
in the representation of sub-grid-scale convection and unification
with the representation of turbulence, particularly at the grey zone.
However, there is a long way to go, particularly as multi-fluids requires
a dedicated model rather than being a stand alone parameterisation
for a dynamical core. \citeA{TEB19} and \citeA{WM19} presented solutions
of the multi-fluid equations assuming two fluids that share the same
pressure (or that pressure differences are predominantly due to drag
between the fluids). \citeA{TEB19} showed that these equations (without
drag) are in fact unstable and can be stabilised by diffusion of vertical
velocity whereas \citeA{WM19} stabilised the equations with diffusion
and drag between fluids. Neither of these stabilisation techniques
are acceptable and in this paper we show that there are significant
and sustained pressure differences between the fluids (section \ref{sec:results}). 

This paper presents the multi-fluid Boussinesq equations for representing
sub-grid-scale convection including a parameterisation of the pressure
difference between fluids (section \ref{subsec:fluidPressure}) and
a new model of entrainment and detrainment (section \ref{subsec:Sij}).
The numerical method for solving the equations is described in section
\ref{sec:numerics}. We compare results of resolved dry convection
in a single-fluid two dimensional Boussinesq model with a two-fluid,
\change[HW]{single}{one} column model in section \ref{sec:results} using two vertical
slice test cases.

\section{The Multi-fluid Boussinesq Equations}

Many of the challenges of representing convection with the multi-fluid
Navier-Stokes equations \cite<e.g. those described in>{WM19} carry
over to the Boussinesq equations; convection is buoyancy dominated
and close to incompressible. The resolved test cases presented in
section \ref{sec:results} give very similar results for Navier-Stokes
and Buossinesq equations. Therefore for simplicity we focus on the
\remove[HW]{multi-fluid} Boussinesq equations without background stratification:
\note[HW]{This is additional material until the start of 2.1}
\begin{eqnarray}
\frac{\partial \mathbf{u}}{\partial t} + \nabla\cdot(\mathbf{u}\mathbf{u})
+\nabla P & = & b \mathbf{k}+\nu\nabla^{2}\mathbf{u}
\label{eq:singleMom}
\\
\frac{\partial b}{\partial t} + \nabla\cdot(\mathbf{u}b)
 & = & \alpha\nabla^{2}b
\label{eq:singleb}
\\
\nabla\cdot\mathbf{u} & = & 0
\label{eq:singleDivFree}
\end{eqnarray}
where variables are defined in table \ref{tab:defns}. 

\begin{table}
\begin{tabular}{c>{\raggedright}p{0.85\textwidth}}
$\sigma_{i}$ & Volume fraction of fluid $i$ so that $\sum_{i}\sigma_{i}=1$\tabularnewline
$\mathbf{u}$ & 
Velocity of the single-fluid equations  ($\text{m}\text{s}^{-1}$) and velocity averaged over all fluids of the multi-fluid equations
\tabularnewline
$\mathbf{u}_{i}$ & Velocity of fluid $i$ ($\text{m}\text{s}^{-1}$)\tabularnewline
$w_{i}$ & Vertical component of $\mathbf{u}_{i}$ ($\text{m}\text{s}^{-1}$)\tabularnewline
$S_{ij}$ & Transfer from fluid $i$ to $j$ ($\text{s}^{-1}$)
\tabularnewline
$P$ & Non-hydrostatic pressure of the single-fluid equations $=p^{\prime}/\rho_{r}$ ($\text{m}^{2}\text{s}^{-2}$) and pressure averaged over all fluids of the multi-fluid equations
\tabularnewline
$P_{i}$ & Non-hydrostatic pressure of fluid $i$ 
\tabularnewline
$p_{i}$ & $P_i - P$
\tabularnewline
$\psi_{ij}^{T}$ & Value of variable $\psi$ transferred from fluid $i$ to $j$\tabularnewline
$b$ & Buoyancy of single-fluid equations defined as -$g\rho^{\prime}/\text{\ensuremath{\rho}}_{r}$
where $\rho^{\prime}$ are departures in density from a horizontally
uniform reference, $\rho_{r}$ ($\text{m}\text{s}^{-2}$) and buoyancy averaged over all fluids of the multi-fluid equations
\tabularnewline
$b_{i}$ & Buoyancy of fluid $i$ ($\text{m}\text{s}^{-2}$)\tabularnewline
$D_{i}\big/Dt$ & Total derivative with respect to fluid $i$ $=\partial/\partial t+\mathbf{u}_{i}\cdot\nabla$\tabularnewline
$\mathbf{D}_{ij}$ & Drag on fluid $i$ from fluid $j$ ($\text{m}\text{s}^{-2}$)\tabularnewline
$\gamma$ & Coefficient for setting the pressure local for each fluid ($\text{m}^{2}\text{s}^{-1}$)\tabularnewline
$C_{D}$ & Drag coefficient $=0$ or 1\tabularnewline
$r_{c}$ & Plume radius used for defining the drag between fluids (m)\tabularnewline
$\alpha$ & Diffusivity of buoyancy ($\text{m}^{2}\text{s}^{-1}$)\tabularnewline
$\nu$ & Viscosity ($\text{m}^{2}\text{s}^{-1}$)\tabularnewline
\end{tabular}
\caption{Definitions of variables for the single- and multi-fluid Boussinesq equations.\label{tab:defns}}
\end{table}

The single-fluid Boussinesq equations will be conditionally averaged following \citeA{TWV+18} to give the multi-fluid Boussinesq equations. Lagrangian labels for each fluid $i$ are defined as $I_i=1$ in fluid $i$ and zero elsewhere and satisfy:
\begin{equation}
\frac{DI_i}{Dt}=0.
\label{eq:LagrangianLabel}
\end{equation}
Applying the conditional average to $I_i$ we define the volume fraction of fluid $i$ and the velocity and buoyancy of fluid $i$:
\begin{eqnarray}
\sigma_i &=& \overline{I_i} \\
\sigma_i \mathbf{u}_i &=& \overline{I_i \mathbf{u}} \\
\sigma_i b_i &=& \overline{I_i b}
\label{eq:defineFluidFields}
\end{eqnarray}
which implies
\begin{equation}
\sum_{i}\sigma_{i}  =  1.
\label{eq:sumOne}
\end{equation}
As we are considering the Boussinesq equations we assume that variations in density only affect the buoyancy terms so $\mathbf{u}_i$ and $b_i$ are defined without density weighting. 

To derive a transport equation for $\sigma_i$ we combine (\ref{eq:LagrangianLabel}) with $I_i$ times (\ref{eq:singleDivFree}) and volume average. After permuting operators with the averaging \cite<as described by>{TWV+18} and using the definitions of $\sigma_i$ and $\mathbf{u}_i$ we get the evolution equation for $\sigma_i$:
\begin{equation}
\frac{\partial\sigma_{i}}{\partial t}+\nabla\cdot\sigma_{i}\mathbf{u}_{i}  =  \sum_{j\ne i}\left\{ \sigma_{j}S_{ji}-\sigma_{i}S_{ij}\right\}
\label{eq:sigma}
\end{equation}
which also includes transfers between fluids with $\sigma_{i}S_{ij}$ being the transfer from fluid $i$ to $j$.

Next we will consider conditionally averaging the terms of the momentum (\ref{eq:singleMom}) and buoyancy (\ref{eq:singleb}) equations. Conditionally averaging the advection terms leads to sub-filter-scale fluxes, $F_{SF}$, since the velocity and buoyancy are not uniform within each fluid at the filter scale:
\begin{eqnarray}
\overline{I_i \nabla \cdot (\mathbf{u} \mathbf{u})} &=& \nabla \cdot (\sigma_i \mathbf{u}_i  \mathbf{u}_i) + F_\text{SF}^{\mathbf{u}_i} \\
\overline{I_i \nabla (\mathbf{u} b)} &=&  \nabla \cdot (\sigma_i \mathbf{u}_i b_i) + F_\text{SF}^{b_i}
\label{eq:filterAdvection}
\end{eqnarray}
The sub-filter-scale fluxes will be absorbed into the diffusion terms for momentum and buoyancy.

\note[HW]{Dan, can we do better than this?}
Lots of terms appear when attempting to conditionally average the diffusion terms which we do not know how to parameterise. Therefore we will use simply:
\begin{eqnarray}
\overline{I_i \nu \nabla^2 \mathbf{u}} &=& \sigma_i \nu \nabla^2 \mathbf{u}_i \\
\overline{I_i \alpha \nabla^2 b} &=& \sigma_i \alpha \nabla^2b_i .
\end{eqnarray} 

Unlike \citeA{TWV+18} we define separate pressures for each fluid, $P_i$. The pressures are defined to satisfy:
\begin{equation}
\overline{I_i \nabla P} = \sigma_i \nabla P_i.
\end{equation}

Combining these gives the conditionally averaged momentum and buoyancy equations:
\begin{eqnarray}
\frac{\partial\sigma_i\mathbf{u}_{i}}{\partial t} + 
\nabla\cdot(\sigma_i \mathbf{u}_{i} \mathbf{u}_{i})
+ \sigma_i \nabla P_{i}
& = &
\sigma_i b_{i}\mathbf{k}
+
\nu\sigma_i\nabla^{2}\mathbf{u}_{i}
+
\sum_{j\ne i}\left\{ \sigma_{j}S_{ji}\mathbf{u}_{ji}^{T}
 - \sigma_{i}\mathbf{D}_{ij}\right\}
\label{eq:momFlux}\\
\frac{\partial\sigma_i b_{i}}{\partial t} + 
\nabla\cdot(\sigma_i \mathbf{u}_{i} b_{i})
& = &
\alpha\sigma_i\nabla^{2}b_{i}
+
\sum_{j\ne i} \sigma_{j}S_{ji} b_{ji}^{T}.
\label{eq:bFlux}
\end{eqnarray}
These equations include mass transfers between fluids with $\mathbf{u}_{ij}^T$ being the velocity of the fluid transferred from $i$ to $j$ and $b_{ij}^T$ being the buoyancy of the fluid transferred from $i$ to $j$. A drag term, $\mathbf{D}_{ij}$ is also included to parameterise some of the missing terms because it is commonly used when conditional averaging is applied in fields such as multi-phase modelling \cite<eg>{GBB+07}. Sensitivity to $\mathbf{D}_{ij}$ will be investigated in section \ref{sec:results}. 

Eqns ({eq:momFlux}) and ({eq:bFlux}) are solved in advective form in which the mass transfer terms are more complicated:
\begin{eqnarray}
\frac{D_{i}\mathbf{u}_{i}}{Dt}+\nabla P_{i}
& = &
b_{i}\mathbf{k}+\nu\nabla^{2}\mathbf{u}_{i}+\sum_{j\ne i}\left\{ \frac{\sigma_{j}}{\sigma_{i}}S_{ji}\left(\mathbf{u}_{ji}^{T}-\mathbf{u}_{i}\right)-S_{ij}(\mathbf{u}_{ij}^{T}-\mathbf{u}_{i})-\mathbf{D}_{ij}\right\}
\label{eq:mom}\\
\frac{D_{i}b_{i}}{Dt}
& = &
\alpha\nabla^{2}b_{i}+\sum_{j\ne i}\left\{ \frac{\sigma_{j}}{\sigma_{i}}S_{ji}\left(b_{ji}^{T}-b_{i}\right)-S_{ij}\left(b_{ij}^{T}-b_{i}\right)\right\} \label{eq:b}
\end{eqnarray}
where $D_{i}\big/Dt=\partial/\partial t+\mathbf{u}_{i}\cdot\nabla$ is the total derivative with respect to fluid $i$, 

Finally the multi-fluid version incompressibility is
\begin{equation}
\sum_{i}\nabla\cdot\sigma_{i}\mathbf{u}_{i}  = \nabla\cdot\sum_{i}\sigma_{i}\mathbf{u}_{i}=0.
\label{eq:divFree}
\end{equation}

\subsection{Pressure of each fluid \label{subsec:fluidPressure}}

\citeA{TEB19} and \citeA{WM19} assumed that each co-located fluid
shared the same pressure, leading to unstable equations that \citeA{TEB19}
stabilised using diffusion of vertical velocity and \citeA{WM19}
stabilised using mass exchanges or drag between the fluids. \citeA{TEB19}
achieved realistic results in \change[HW]{single}{one} column experiments of convective
boundary layer but the amount of diffusion needed would spoil simulations
in the free troposphere. The stabilisation used by \citeA{WM19} meant
that the two fluids tended to move as one which defeats the purpose
of using multi-fluid modelling. 

The instabilities reported by \citeA{WM19} showed growing divergence
in a fluid with vanishing volume fraction. \change[HW]{It is mass convergence
rather than velocity convergence that leads to pressure anomalies
that remove the convergence. Therefore if the volume (or mass) fraction
of fluid is vanishingly low then convergence cannot lead to an anomaly
in the total pressure.}{For single-fluid equations, divergence would lead to pressure anomalies which would act as a negative feedback on the divergence. However for multi-fluids if one of the volume fractions is too small then it cannot force pressure anomalies big enough to stabilise the divergence. Use of separate pressure for each fluid is proposed to ensure stability.}

We will assume that pressure in each fluid is given by a parameterised
perturbation, $p_{i}$, from the total pressure, $P$:
\begin{equation}
P_{i}=P+p_{i}.
\end{equation}
\add[HW]{In order to derive a suitable form of parameterisation for $p_i$ we will first consider the} \citeA{BN86} \add{model.}

\subsubsection{\add[HW]{The \protect\citeA{BN86} model}}

\citeA{BN86} proposed a parameterisation for pressure differences
in a multi-phase explosion model that has been widely used in mathematics
and engineering for simulating, \add[HW]{for example}, fluidised beds of granular material \cite<e.g.>{EHM92} and two compressible fluids \cite<e.g.>{SA99}. \add[HW]{This model is not used here but is examined in order to derive a method suitable for atmospheric convection.}
\citeA{SA99} wrote transport equations for both the volume fraction,
$\sigma_{i}$, and for the mass fraction,
$\sigma_{i}\rho_{i}$  without transfers between fluids which in our notation are:
\begin{eqnarray}
\frac{\partial\sigma_{i}}{\partial t}+\mathbf{V}\cdot\nabla\sigma_{i} & = & \mu\left(P_{i}-P_{j}\right)
\label{eq:BNcompaction}
\\
\frac{\partial\sigma_{i}\rho_{i}}{\partial t}+\nabla\cdot\left(\sigma_{i}\rho_{i}\mathbf{u}_{i}\right) & = & 0
\label{eq:rhoTransport}
\end{eqnarray}
where $\mathbf{V}$ is the velocity of the interface between fluids,
$\mu$ is the compaction viscosity which controls how quickly the
pressure of each fluid relaxes to the mean pressure and index $j$
refers to the other fluid in a two fluid system. In our Boussinesq
system $\rho_{i}$ does not appear in the continuity equation. Different
authors make different assumptions about the interface velocity but
if we assume that $\mathbf{V}=\sum_{i}\sigma_{i}\mathbf{u}_{i}$ and
$\rho_{i}$ is constant then eqns (\ref{eq:divFree}), (\ref{eq:sumOne}), (\ref{eq:BNcompaction}) and (\ref{eq:rhoTransport})
imply that $\mu p_{i}=-\sigma_{i}^{2}\nabla\cdot\mathbf{u}_{i}$.
If we assume that $\mathbf{V}=\mathbf{u}_{i}$ for each fluid then
we get $\mu p_{i}=-\sigma_{i}\nabla\cdot\mathbf{u}_{i}$.

\subsubsection{\add[HW]{Proposed Model for Pressure Differences between Fluids}}

\citeA{TEB19} stabilised the multi-fluid equations by adding a diffusion
term $\nu\partial w^{2}/\partial z^{2}$ to the RHS of the $w$ equation.
If a fluid perturbation pressure is set to $-\nu\partial w/\partial z$
this is equivalent to the diffusion term in one dimension. However
adding a diffusion term will harm three dimensional simulations of
resolved convection in the free troposphere whereas adding a fluid
perturbation pressure will not. Inspired by both \citeA{BN86} and
\citeA{TEB19} we assume that the pressure in each fluid is given
by:
\begin{equation}
p_{i}=-\gamma\nabla\cdot(\sigma_i \mathbf{u}_{i})
\label{eq:Pi_div}
\end{equation}
where $\gamma$ is a \change[HW]{free coefficient}{compressibility with units $\text{m}^s \text{s}^{-1}$. 
This parameterisation of $p_i$ has $\sigma_i$ inside the divergence in order to ensure that $\sum_i p_i =0$ and $\therefore$ that $\sum_i P_i = P$.}

\change[HW]{Dimensional}{Scale} analysis in section
\ref{subsec:dimAnal} will inform the choice of $\gamma$ and sensitivity
to $\gamma$ will be evaluated in section \ref{sec:results}.

\subsection{Entrainment and Detrainment \label{subsec:Sij}}

We consider dry air without turbulence so use the dynamic entrainment
described by \citeA{HC51},\citeA{AK67} and \citeA{DBF+13}:
\begin{equation}
S_{ij}=\begin{cases}
-\nabla\cdot\mathbf{u}_{i} & \text{if }\nabla\cdot\mathbf{u}_{i}<0\\
0 & \text{otherwise}
\end{cases}
\end{equation}
which is necessary to stop air in one fluid from accumulating when
vertical motion ceases (at the top of a rising plume or at the bottom
of descending air). We will also test a common form of lateral entrainment
\cite{DBF+13}:
\begin{equation}
\varepsilon=\frac{0.2}{r_{c}}
\end{equation}
where $\varepsilon$ is the well know fractional entrainment rate
and $r_{c}$ is the cloud or plume radius. Fractional entrainment is related to mass transfers by:
\begin{equation}
S_{01} = w_{1}\varepsilon.
\end{equation}

\subsection{Drag in the Momentum Equation\label{subsec:drag}}

Pressure differences between the fluids can lead to form drag which
is parameterised following \citeA{SW69}, \citeA{RC15} and \citeA{WM19} as: 
\begin{equation}
\mathbf{D}_{ij}=\frac{\sigma_{j}C_{D}}{r_{c}}|\mathbf{u}_{i}-\mathbf{u}_{j}|\left(\mathbf{u}_{i}-\mathbf{u}_{j}\right)\label{eq:dragBubble}
\end{equation}
where $C_{D}$ is a drag coefficient, $r_{c}$ is a cloud radius.
Sensitivity to $C_{D}/r_{c}$is explored in section \ref{sec:results}. 

\subsection{The Buoyancy and the Momentum of the Mass that is Transferred \label{subsec:transferProperties}}

The different fluids may not be well mixed so the fluid transferred
may not have the mean properties of the fluid it is leaving \cite<as was assumed by>{WM19}.
In fact, the most buoyant air should be transferred from fluid 0 to
fluid 1 and vice versa, and the air with least downward momentum should
be transferred from 0 to 1 and vice versa. The properties of the fluids
transferred should depend on the modelling of sub-grid-scale variability
which is beyond the scope of this paper. In section \ref{sec:results}
we conditionally average high resolution solutions based on the sign
of $w$ so that $w<0$ air is in fluid 0 and $w>0$ air in fluid 1.
Therefore the air that is transferred at the interface will have $w=0$.
For two dimensional multi-fluid simulations we assume that the horizontal
velocity transferred is equal to the mean horizontal velocity of the
fluid transferred from. Therefore
\begin{equation}
\mathbf{u}_{ij}^{T}=\begin{pmatrix}u_{i}\\
v_{i}\\
0
\end{pmatrix}.
\end{equation}
For buoyancy, following \citeA{TEB19}, we use:
\begin{equation}
b_{ij}^{T}=\theta_{b}b_{i}+(1-\theta_{b})b_{j}
\end{equation}
and present results using $\theta_{b}=\frac{1}{2}$ and $\theta_{b}=1$.
\add[HW]{
$\theta_{b}=1$ is described as an upstream approximation by \protect\citeA{Yano14} and is widely used for entrainment \protect\cite<eg.>{AK67,AS74}.
}
Note that $\theta_{b}\ne1$ implies that the buoyancy of the fluid
transferred depends on the properties of the receiving fluid which
is not logical and can lead to unbounded values of $b_{i}$ in the
fluid that is loosing mass (as demonstrated in section \ref{sec:results}).

\subsection{\change[HW]{Dimensional}{Scale} Analysis\label{subsec:dimAnal}}

Dimensional analysis can guide our choice of $\gamma$ for the parameterisation of the pressure difference between fluids. We make the following assumptions
\add[HW]{in this analysis}:
\begin{enumerate}
\item The flow is buoyancy dominated.
\item The flow is close to inviscid.
\item The flow is slowly varying.
\item Fluid $i$ properties are anomalies from a neutrally stable resting
mean state 
\add[HW]{implying that the average over all fluids of $b_i$, $\mathbf{u}_i$ and $P_i$ are zero}.
\item We consider only the vertical direction where $w_{ij}^{T}=0$.
\item $P_{i}=P-\gamma\nabla\cdot\mathbf{u}_{i}\approx-\gamma\nabla\cdot\mathbf{u}_{i}=-\gamma\frac{\partial w_{i}}{\partial z}$
\item There are two fluids, $i$ and $j$
\item Without loss of generality we assume that $S_{ij}=-\frac{\partial w_{i}}{\partial z}>0$
and $S_{ji}=0$.
\end{enumerate}
This leads to the following balance in the momentum equation:
\begin{equation}
\frac{\partial w_{i}^{2}}{\partial z}-\gamma\frac{\partial^{2}w_{i}}{\partial z^{2}}=b_{i}\label{eq:wi_balances}
\end{equation}
We non-dimensionalise using a length scale $L$, a buoyancy scale
$B$ and a time scale $T$ to get the non-dimensional variables:
\begin{eqnarray*}
\tilde{w} & = & w_{i}T/L\\
\tilde{b} & = & b_{i}/B\\
\tilde{z} & = & z/L.
\end{eqnarray*}
Then the non-dimensional version of (\ref{eq:wi_balances}) is:
\begin{equation}
\underbrace{{\frac{L}{T^{2}}\frac{\partial\tilde{w}^{2}}{\partial\tilde{z}}}}_{\text{advection}}-\underbrace{{\frac{\gamma}{TL}\frac{\partial^{2}\tilde{w}}{\partial\tilde{z}^{2}}}}_{\text{stabilisation}}=\underbrace{B\tilde{b}}_{\text{buoyancy}}.\label{eq:wi_nonDomTmp}
\end{equation}
The flow is buoyancy dominated so the buoyancy term should be $O(1)$
so we choose the scaling $B=L/T^{2}\implies T=(L/B)^{\frac{1}{2}}$
so the non-dimensional momentum equation becomes:
\begin{equation}
\underbrace{{\frac{\partial\tilde{w}^{2}}{\partial\tilde{z}}}}_{\text{advection}}-\underbrace{{\frac{\gamma}{B^{\frac{1}{2}}L^{\frac{3}{2}}}\frac{\partial^{2}\tilde{w}}{\partial\tilde{z}^{2}}}}_{\text{stabilisation}}=\underbrace{\tilde{b}}_{\text{buoyancy}}.\label{eq:wi_nonDom-1}
\end{equation}
The stabilisation term must be large enough to smooth out oscillations
in $\tilde{w}$ due to advection and buoyancy but not too large to
remove all variability in $\tilde{w}$ so we need:
\begin{equation}
\gamma\sim B^{\frac{1}{2}}L^{\frac{3}{2}}.\label{eq:gammaDimAnal}
\end{equation}


\section{Numerical Solution \label{sec:numerics}}

The spatial discretisation follows exactly \citeA{WM19}, solving
advective form equations using monotonic, finite volume advection
and C-grid, Lorenz staggering. The time-stepping is Crank-Nicolson
with no off-centering and with deferred correction of explicitly solved
variables. It differs from \citeA{WM19} because here we solve the
Boussinesq equations and we need stable solutions for equations with
a separate pressure in each fluid. We use two outer iterations per
time step to update explicitly solved variables. For the first outer
iteration, predicted values for time $n+1$ are set to those from
time level $n$ and are given the superscript $\ell$. For the second
iteration, values at $\ell$ are set to those from the end of the
first iteration. The implicit numerical method for applying the transfers
between fluids is specific for two fluids because it involves the
inversion of $2\times2$ matrices. 

The prognostic variables are the $b_{i}$ in cell centres, the $\sigma_{i}$
in cell centres and the velocity flux at cell faces, $u_{i}=\mathbf{u}_{i}\cdot\mathbf{S}$,
which is the velocity at cell faces dotted with the area vector for
each face (normal to the face). The pressures, $P$ and $p_{i}$ are
diagnostic.

The first equation to be solved each outer iteration is eqn (\ref{eq:sigma})
for each $\sigma_{i}$, operator split; first applying advection,
then correcting $\sum_{i}\sigma_{i}=1$ and then applying mass transfers:
\begin{eqnarray}
\sigma_{i}^{\prime} & = & \sigma_{i}^{n}-\frac{\Delta t}{2}\nabla\cdot\left\{ \left(\mathbf{u}_{i}^{n}+\mathbf{u}_{i}^{\ell}\right)\left(\sigma_{i}^{n}\right)_{vL}\right\} \\
\sigma_{i}^{\prime\prime} & = & \sigma_{i}^{\prime}\bigg/\sum_{i}\sigma_{i}^{\prime}\\
S_{ij} & = & \begin{cases}
-\nabla\cdot\mathbf{u}_{i}^{\ell} & \text{if }\nabla\cdot\mathbf{u}_{i}^{\ell}<0\\
0 & \text{otherwise}
\end{cases}\\
\sigma_{i}^{n+1} & = & \sigma_{i}^{\prime\prime}+\Delta t\sum_{j\ne i}\sigma_{j}^{\prime\prime}S_{ji}-\sigma_{i}^{\prime\prime}S_{ij}
\end{eqnarray}
where $\Delta t$ is the time step and the superscripts $\prime$
and $\prime\prime$ denote intermediate values. $\sigma_{i}^{n}$
is interpolated from cell centres onto cell faces using monotonic
van-Leer advection (operator $(\sigma_{i}^{n})_{vL}$) as in \citeA{WM19}
and values exclusively at time level $n$ for best accuracy and guaranteed
monotonicity. For calculating the divergence, the normal component
of $\mathbf{u}_{i}$ is needed at cell faces which are prognostic
variables of the C-grid. The $S_{ij}$ are limited to ensure $0<\sigma_{i}<1\ \forall i$. 

Next eqn (\ref{eq:b}) is solved for the buoyancy in each fluid, first
transporting buoyancy and then applying the transfer terms. The transfer
terms can be very large due to the presence of $\frac{\sigma_{j}}{\sigma_{i}}S_{ij}$
in the transfer term for $b_{i}$ so they are treated operator split
and implicitly:
\begin{eqnarray}
b_{i}^{\prime} & = & b_{i}^{n}-\frac{\Delta t}{2}\Biggl(\left(\nabla\cdot\left(\mathbf{u}_{i}(b_{i})_{vL}\right)+b_{i}\nabla\cdot\mathbf{u}_{i}+\alpha\nabla^{2}b_{i}\right)^{n}\label{eq:transportb}\\
 &  & \hfill+\left(\nabla\cdot\left(\mathbf{u}_{i}(b_{i})_{vL}\right)+b_{i}\nabla\cdot\mathbf{u}_{i}+\alpha\nabla^{2}b_{i}\right)^{\ell}\Biggr)\\
b_{0}^{n+1} & = & b_{0}^{\prime}+\Delta t\left\{ \left(\frac{\sigma_{1}}{\sigma_{0}}\right)^{\prime\prime}S_{10}\left(b_{1}^{n+1}+b_{10}^{t}-b_{0}^{n+1}\right)-S_{01}b_{01}^{t}\right\} \label{eq:b0np1}\\
b_{1}^{n+1} & = & b_{1}^{\prime}+\Delta t\left\{ \left(\frac{\sigma_{0}}{\sigma_{1}}\right)^{\prime\prime}S_{01}\left(b_{0}^{n+1}+b_{01}^{t}-b_{1}^{n+1}\right)-S_{10}b_{10}^{t}\right\} \label{eq:b1np1}
\end{eqnarray}
where $b_{ij}^{t}=b_{ij}^{T}-b_{i}$. The use of $(\sigma_{0}/\sigma_{1})^{\prime\prime}$
from before the mass transfers is necessary to ensure bounded and
conservative transfers, as described by \cite{MWH1x}. Simultaneous
solutions of (\ref{eq:b0np1}) and (\ref{eq:b1np1}) give:
\begin{eqnarray}
b_{0}^{n+1} & = & \frac{\left(1+T_{01}\right)\left(b_{0}^{\prime}-\Delta tS_{01}b_{01}^{t}+T_{10}b_{10}^{t}\right)+T_{10}\left(b_{1}^{\prime}+T_{01}b_{01}^{t}-\Delta tS_{10}b_{10}^{t}\right)}{1+T_{01}+T_{10}}\\
b_{1}^{n+1} & = & \frac{b_{1}^{\prime}+T_{01}b_{0}^{n+1}+T_{01}b_{01}^{t}-\Delta tS_{10}b_{10}^{t}}{1+T_{01}}
\end{eqnarray}
where $T_{ij}=\Delta t\left(\frac{\sigma_{i}}{\sigma_{j}}\right)^{\prime\prime}S_{ij}$

Next a Poisson equation is solved to calculate the total pressure,
$P$ to ensure that the total velocity is divergence free. \add[HW]{This is the standard approach for ensuring divergence constraints \protect\cite<eg>{SKW14}.} The pressure
equation also provides updates for the velocity flux, $u_{i}$. First
an intermediate velocity flux is calculated with partial updates and
updates from a previous value of $p_{i}$:
\begin{eqnarray}
u_{i}^{\prime}= & u_{i}^{n}+\frac{\Delta t}{2} & \biggl(\left(-\nabla\cdot(\mathbf{u}_{i}\mathbf{u}_{i})+\mathbf{u}_{i}\nabla\cdot\mathbf{u}_{i}+b_{i}\mathbf{k}\right)_{f}^{\ell}\cdot\mathbf{S}-\nabla_{f}p_{i}^{\ell}\\
 &  & +\left(-\nabla\cdot(\mathbf{u}_{i}\mathbf{u}_{i})+\mathbf{u}_{i}\nabla\cdot\mathbf{u}_{i}+b_{i}\mathbf{k}\right)_{f}^{n}\cdot\mathbf{S}-\nabla_{f}(P+p_{i})^{n}\biggr)
\end{eqnarray}
where operator $()_{f}$ means linear interpolation from cell centres
onto cell faces and $\nabla_{f}P$ is a compact discretisation of
$(\nabla P)_{f}\cdot\mathbf{S}$: ie the normal component of the pressure
gradient calculated from just the values of pressure either side of
the face. Once we have calculated $P^{n+1}$, the velocity flux (without
momentum transfers) is updated from the back-substitution:
\begin{equation}
u_{i}^{\prime\prime}=u_{i}^{\prime}-\frac{\Delta t}{2}\nabla_{f}P^{n+1}.\label{eq:backSub}
\end{equation}
The Poisson equation for $P^{n+1}$ is found by multiplying each eqn
(\ref{eq:backSub}) by $\sigma_{i}$, summing over all fluids and
taking the divergence. Knowing that $\nabla\cdot\sum_{i}\sigma_{i}\mathbf{u}_{i}=0$,
$\sum_{i}\sigma_{i}=1$ and $\sum_{i}\sigma_{i}p_{i}=0$ gives:
\begin{equation}
\nabla\cdot\sum_{i}\sigma_{i}u_{i}^{\prime}-\frac{\Delta t}{2}\nabla^{2}P^{n+1}=0
\end{equation}
which is solved to find $P^{n+1}$. 

Next, the momentum transfers due to mass transfer and due to drag
are calculated implicitly, similar to the implicit transfers of buoyancy,
calculating $u_{i}^{n+1}$ from $u_{i}^{\prime\prime}$. These do
not influence the total $P$ or total divergence because momentum
is transferred conservatively. However they do influence $p_{i}$
which is why they are calculated before $p_{i}$. The final stage
of the time step iteration is to solve Helmholtz equations for each
$p_{i}$:
\begin{equation}
\sigma_{i}^{n+1}p_{i}^{n+1}=-\gamma\nabla\cdot\left(\sigma_{if}^{n+1}u_{i}^{n+1}-\frac{\Delta t}{2}\sigma_{if}^{n+1}\nabla_{f}\left(p_{i}^{n+1}-p_{i}^{\ell}\right)\right).\label{eq:pi_Helm}
\end{equation}
Both $p_{i}^{n+1}$ and $p_{i}^{\ell}$ appear in eqn (\ref{eq:pi_Helm})
because $u_{i}^{n+1}$ already contains contributions from $p_{i}^{\ell}$
so these are removed before updating $p_{i}^{n+1}$. No back substitution
for $u_{i}$ is done after calculating $p_{i}^{n+1}$ because this
would destroy the divergence free constraint. Therefore $p_{i}^{n+1}$
only satisfies eqn (\ref{eq:Pi_div}) exactly if the outer iterations
converge and $p_{i}^{\ell}=p_{i}^{n+1}$. 

The final stage of the time step iteration is to reconstruct $\mathbf{u}_{i}$
from $u_{i}$ following \citeA{WM19}. The stages calculating $P$,
$p_{i}$ and $\mathbf{u}_{i}$ are repeated twice per time step iteration.
The Poisson and Helmholtz equations are solved to a tolerance of $10^{-6}$.

\subsection{\add[HW]{Discrete Conditional Averaging} \label{sec:cAveraging}}

\note[HW]{This whole sub-section is new}

A single-fluid solution is conditionally averaged by:
\begin{equation}
i =
\begin{cases}
    0 & \text{ if }w\le 0 \\
    1 & \text{ otherwise.}
\end{cases}
\end{equation}
If an entire grid box is assigned to be either in fluid 0 or fluid 1 based on $w$ at the cell centre then $\sigma$ can only take a small number of discrete values depending on the resolution of the conditional averaging. For example, if conditional averaging goes from $n$ columns to 1 column with vertical resolution staying the same, then $\sigma$ can only take values $\frac{k}{n}$ where $k$ is an integer between zero and $n$. This means that $\sigma$ is either uniform (for small $n$) or has jumps in the vertical (for larger $n$). An alternative is therefore proposed in order to approximate $\sigma$ based on $w$ and $\nabla w$ at cell centres. This is based on the intersection between a grid box and the surface of $w=0$. Given a grid box with centre $\mathbf{x}_c$, the surface of points, $\mathbf{x}_w$ of $w=0$ satisfies:
\begin{equation}
\nabla w \cdot \left(\mathbf{x}_c - \mathbf{x}_w\right) = 0
\end{equation}
Rather than the expense of calculating exact grid box volume fractions either side of this surface, the signed distance of each grid box vertex, $\mathbf{x}_v$, to the surface is calculated:
\begin{equation}
d_v = \left(
     \mathbf{x}_v - \mathbf{x}_c + \frac{w \nabla w}{|\nabla w|^2} 
\right) \cdot \frac{\nabla w}{|\nabla w|}.
\end{equation}
The volume fraction either side of the $w=0$ surface is approximated by the average distance to vertices in one side of the surface divided by the average distance to vertices on both side:
\begin{equation}
\sigma_0 = 
\frac{-\text{mean}\bigl(\text{all } d_v \text{ with } d_v \le 0\bigr)}
{\text{mean}\bigl(\text{all } |d_v| \bigl)}
\;\;\;\;\;\;
\sigma_1 = 
\frac{\text{mean}\bigl(\text{all } d_v \text{ with } d_v > 0\bigr)}
{\text{mean}\bigl(\text{all } |d_v| \bigl)}.
\end{equation}
This gives smooth $\sigma$ fields that will be shown in section \ref{sec:results}.

\section{Validation Test Cases\label{sec:results}}

Two test cases are developed to tune parameters and to validate the
use of multi-fluid equations to represent dry, two-dimensional, sub-grid-scale
convection. The first is transient; the standard rising bubble of
\citeA{BF02}. \remove{We aim to reproduce the vertical heat transport, the
mean velocity of the rising air, the bouyancy of the rising air and
pressure differences between two fluids in a single column two fluid
model.} The second test case is steady state with heat transfer at
the ground and uniform radiative cooling. For both test cases the
reference solution is a single-fluid solution of the two-dimensional
Boussinesq equations at high horizontal and vertical resolution. \add[HW]{This will be compared with the two-fluid model run using one column. We aim to reproduce the vertical heat transport, the mean velocity of the rising air, the bouyancy of the rising air and the pressure differences between fluids in one column two-fluid model.}

\subsection{Rising Bubble}

The \add[HW]{two dimensional} test case of \citeA{BF02} was designed for fully compressible
models but similar solutions are obtained solving Boussinesq equations.
The Boussinesq version has no background stratification in a domain
of height 10\,km and width 20\,km initially at rest. The buoyant
perturbation is given by:
\begin{equation}
b=\frac{1}{15}\cos^{2}\frac{\pi L}{2}\label{eq:thetaPerturb}
\end{equation}
for $L<1$ where $L=\sqrt{\left(\frac{x-x_{c}}{x_{r}}\right)^{2}+\left(\frac{z-z_{c}}{z_{r}}\right)^{2}}$,
$x_{c}=10\ \text{km}$, $z_{c}=2\ \text{km}$ and $x_{r}=z_{r}=2\ \text{km}$.
100\,m grid spacing is used in the $x$ and $z$ directions for the
two dimensional reference simulation and $\Delta z=100\ \text{m}$
is used in the vertical for the \change[HW]{single}{one} column simulations. All simulations
use a time-step of 2\,s.

\subsubsection{Single-Fluid Solutions}

The solution of the \add[HW]{resolved 2D} rising buoyant bubble solving the Boussinesq equations
for 1000s is shown in figure \ref{fig:bubble} with buoyancy coloured,
pressure contoured and the $w=0$ contour dotted. The solution is
very similar to the fully compressible solution \cite{BF02}. The
pressure gradients accelerate the flow beneath the bubble, decelerate
the flow above the bubble and pull in air horizontally. Horizontally
and conditionally averaged fields, conditioned on $w$, are shown
in the top row of figure \ref{fig:bubble_singleUnderRes}. $\sigma_{1}$
is the volume fraction of rising fluid at every height, $b_{0}$ and
$b_{1}$ are the buoyancy conditioned on $w\le0$ and $w>0$, $w_{0}$
and $w_{1}$ are the horizontal averaging rising and falling vertical
velocity and $P_{0}$ and $P_{1}$ are the pressure of the rising
and falling fluid. An accurate multi-fluid model of convection should
reproduce these fields approximately at coarser horizontal resolution
or in a \change[HW]{single}{one} column model. 

\begin{figure}
\noindent \begin{centering}
\includegraphics[width=1\textwidth]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/resolved/1000/bP}
\par\end{centering}
\noindent \begin{centering}
\includegraphics[width=0.75\textwidth]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/resolved/legends/bP_b}
\par\end{centering}
\caption{The single-fluid, resolved \add[HW]{2D} rising bubble after 1000s. Buoyancy is
coloured and pressure is contoured every $10\text{m}^{2}\text{s}^{-2}$,
negative contours dashed. The $w=0$ contour is dotted.
\label{fig:bubble}}
\end{figure}

\citeA{TEB19} and \citeA{WM19} assumed that both fluids would share
the same pressure with differences parameterised as drag. The pressure
in figure \ref{fig:bubble} shows that this is a bad assumption since
the large pressure anomalies are in the rising fluid. Drag would always
act to slow down the fluids whereas the negative pressure gradients
in the rising fluid just below the bubble are acting to accelerate
the rising motion. 

The horizontal averages are shown in figure \ref{fig:bubble_singleUnderRes}
for horizontal resolutions of nine columns, five columns, three columns
and \change[HW]{a single}{one} column \change{HW}{all for}{covering} the 20km wide domain and all \remove[HW]{still} using
$\Delta z=100\ \text{m}$. These simulations are initialised by conservative
horizontal averaging from the full resolution solution. As the horizontal
resolution is reduced, the vertical transport reduces until there
is no movement at all for \change[HW]{a single column}{the one column simulation}: there is no possibility
of fluid rising because in \change[HW]{a single}{one} column with a single-fluid there
can be no compensating subsidence. The lack of vertical transport
at coarse resolution motivates convection parameterisation. 

\begin{figure}
\noindent %
\begin{tabular}{ccccc}
\begin{turn}{90}
200 Columns
\end{turn} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/resolved/hMean/1000/sigma} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/resolved/hMean/1000/b} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/resolved/hMean/1000/w} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/resolved/hMean/1000/P}\tabularnewline
\begin{turn}{90}
9 Columns
\end{turn} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/nineColumn/hMean/1000/sigma} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/nineColumn/hMean/1000/b} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/nineColumn/hMean/1000/w} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/nineColumn/hMean/1000/P}\tabularnewline
\begin{turn}{90}
5 Columns
\end{turn} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/fiveColumn/hMean/1000/sigma} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/fiveColumn/hMean/1000/b} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/fiveColumn/hMean/1000/w} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/fiveColumn/hMean/1000/P}\tabularnewline
\begin{turn}{90}
3 Columns
\end{turn} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/threeColumn/hMean/1000/sigma} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/threeColumn/hMean/1000/b} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/threeColumn/hMean/1000/w} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/threeColumn/hMean/1000/P}\tabularnewline
\begin{turn}{90}
1 Column
\end{turn} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/singleColumn/hMean/1000/sigma} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/singleColumn/hMean/1000/b} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/singleColumn/hMean/1000/w} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/singleFluid/singleColumn/hMean/1000/P}\tabularnewline
\end{tabular}

\caption{The rising bubble after 1000s simulated with coarse horizontal resolution
and a single-fluid. Horizontal averages are conditioned based on $w$.
\label{fig:bubble_singleUnderRes}}
\end{figure}


\subsubsection{Results of the Two-fluid, \change[HW]{Single}{One} Column Simulations}

\change[HW]{Multi-fluid, single}{Two-fluid, one} column simulations are initialised by horizontally
and conditionally averaging the high resolution single-fluid initial
conditions. Sinking air is put into fluid zero and rising air into
fluid one. The velocity field after one time step is used for initialisation
as the air is stationary at $t=0$. Results are shown in figures \ref{fig:multiFluidSingleColumn-bad}
and \ref{fig:multiFluidSingleColumn} for various assumptions about
transfers between fluids and various parameter values.

\begin{figure}
\setlength{\tabcolsep}{2pt}
\begin{tabular}{cccc}
\multicolumn{4}{c}{\framebox[0.7\linewidth]{\centering
$S_{ij}=0$, \hspace{6pt}
$\gamma=0$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=b_{i}$.
}} \tabularnewline 
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_noTransfer/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_noTransfer/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_noTransfer/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_noTransfer/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.7\linewidth]{\centering
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, \hspace{6pt}
$\gamma=0$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=b_{i}$.
}}\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_divTransfer/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_divTransfer/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_divTransfer/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_divTransfer/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.7\linewidth]{\centering
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, \hspace{6pt}
$\gamma=2.3\!\!\times\!\!10^{4}\text{m}^{2}\text{s}^{-1}$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=b_{i}$.
}}\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_2p3e4_divTransfer/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_2p3e4_divTransfer/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_2p3e4_divTransfer/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_2p3e4_divTransfer/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.7\linewidth]{\centering
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, \hspace{6pt}
$\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=b_{i}$.
}}\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.7\linewidth]{\centering
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, \hspace{6pt}
$\gamma=4\times10^{3}\text{m}^{2}\text{s}^{-1}$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=b_{i}$.
}}\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_4e3_divTransfer/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_4e3_divTransfer/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_4e3_divTransfer/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_4e3_divTransfer/1000/Pcompare}\tabularnewline
$\sigma_{1}$ ($\text{m}^3/\text{m}^3$) & $b$ and $b_{i}$ ($\text{m}\text{s}^{-2}$) & $w_{0}$ and $w_{1}$ (m/s) & $P_{0}$ and $P_{1}$ ($\text{m}^2 \text{s}^{-2}$)\tabularnewline
\end{tabular}

\caption{Results of the rising bubble at $t=1000\ \text{s}$. Solid lines are
the multi-fluid, \change[HW]{single}{one} column solutions of the rising bubble. Dashed
lines are the single-fluid, resolved solutions. \label{fig:multiFluidSingleColumn-bad}}
\end{figure}

\begin{figure}
\setlength{\tabcolsep}{2pt}
\begin{tabular}{cccc}
\multicolumn{4}{c}{\framebox[0.8\linewidth]{\centering
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, \hspace{6pt}
$\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$, \hspace{6pt}
$C_{D}/r_{c}=1/2000\text{m}^{-1}$, \hspace{6pt}
$b_{ij}^{T}=b_{i}$.
} }\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_drag/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_drag/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_drag/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_drag/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.7\linewidth]{\centering
$S_{ij}=0$, \hspace{6pt}
$\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=b_{i}$.
}}\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.8\linewidth]{\centering
$S_{01}=w_{1}0.2/r_{c}$, \hspace{4pt}
$\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$, \hspace{4pt}
$C_{D}/r_{c}=0/2000\text{m}^{-1}$, \hspace{4pt}
$b_{ij}^{T}=b_{i}$.
}}\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_ent/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_ent/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_ent/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_ent/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.7\linewidth]{\centering
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, \hspace{6pt}
$\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=0$.
} }\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT0/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT0/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT0/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT0/1000/Pcompare}\tabularnewline
\multicolumn{4}{c}{\framebox[0.8\linewidth]{\centering
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, \hspace{6pt}
$\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$, \hspace{6pt}
$C_{D}/r_{c}=0$, \hspace{6pt}
$b_{ij}^{T}=\frac{1}{2}\left(b_{0}+b_{1}\right)$.
}}\tabularnewline
\includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT05/1000/sigmaCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT05/1000/bCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT05/1000/wCompare} & \includegraphics[scale=0.6]{/home/hilary/OpenFOAM/hilary-7/run/hilary/warmBubble/Boussinesq/multiFluid/singleColumn_Pi_1e4_divTransfer_bT05/1000/Pcompare}\tabularnewline
$\sigma_{1}$ & $b$, $b_{0}$ and $b_{1}$ & $w_{1}$ & $P_{0}$ and $P_{1}$\tabularnewline
\end{tabular}

\caption{\change[HW]{Results of the rising bubble at $t=1000\ \text{s}$. Solid lines are the multi-fluid, single column solutions of the rising bubble. Dashed lines are the single-fluid, resolved solutions.}
{As figure \protect\ref{fig:multiFluidSingleColumn-bad} but different parameterisation options.}
\label{fig:multiFluidSingleColumn}}
\end{figure}

If there is no drag between fluids, no transfers, no diffusion and
the pressures of both fluids are assumed equal then the multi-fluid
equations are unstable \cite{TEB19}. The simulation with ($S_{ij}=0$)
in the top row of figure \ref{fig:multiFluidSingleColumn-bad} actually
has small transfers to prevent either $\sigma_{i}$ from becoming
negative. This is sufficient to stabilise the solution but does not
prevent oscillations from developing in all fields. The buoyant fluid
has risen very little from the initial conditions. $\sigma$ oscillates
between zero and one meaning that only one fluid is present at some
locations so there is no possibility for the fluids to move past each
other.

Including entrainment and detrainment as $S_{ij}=-\nabla\cdot\mathbf{u}_{i}$
stabilises the solution and enable the fluids to move past each other
even without pressure differences between the fluids (second row of
figure \ref{fig:multiFluidSingleColumn-bad}). However too much is
detrained from fluid 1, fluid 1 looses too much buoyancy and a discontinuity
arises at the bubble leading edge; the buoyancy force is producing
vertical motion but there is no pressure to make it smooth. 

Using entrainment and detrainment set by divergence ($S_{ij}=-\nabla\cdot\mathbf{u}_{i}$)
and pressure difference between the fluids controlled by divergence
($P_{i}=P-\gamma\nabla\cdot\mathbf{u}_{i}$) simulations are more
realistic (bottom three rows of figure \ref{fig:multiFluidSingleColumn-bad}).
Three values of $\gamma$ are tested. $\gamma$ is set from equation
(\ref{eq:gammaDimAnal}) using a length scale equal to the bubble
radius and a buoyancy scale equal to the initial maximum buoyancy
to give $\gamma=2.3\times10^{4}\text{m}^{2}\text{s}^{-1}$. This $\gamma$
(third row of figure \ref{fig:multiFluidSingleColumn-bad}) makes
the velocity profile too smooth and the updraught too weak so the
bubble does not rise enough. It is reasonable to consider smaller
values of $\gamma$ because the buoyancy does not retain its initial
maximum for very long. Using $\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$
gives more accurate solutions whereas using $\gamma=4\times10^{3}\text{m}^{2}\text{s}^{-1}$
leads to the leading edge of the bubble rising too quickly. Smaller
values of $\gamma$ leave a discontinuity in the updraught velocity
at the leading edge of the bubble and larger values of $\gamma$ reduce
the velocity further, meaning that the bubble does not rise enough
(not shown). None of the values of $\gamma$ reproduce the peak updraught
velocities but $\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$ comes closest,
meaning that the bubble rise and $\sigma_{1}$ are approximately correct
and pressure increases above the centre of the bubble are realisitic.
The large low pressure at the bottom of the bubble is not reproduced.
This is located at the lobes of the highest buoyancy in the resolved
simulation (figure \ref{fig:bubble}). It would be tempting to model
this by assuming hydrostatic pressure or the Bernouilli equation,
but these are both forms of the momentum equation which is used to
calculate the velocity and so cannot also be used to model the pressure. 

The results in the top row of figure \ref{fig:multiFluidSingleColumn}
use $\gamma=-10^{4}$ and $S_{ij}=-\nabla\cdot\mathbf{u}_{i}$ but
this time with drag set by $C_{D}/r_{c}=1/2000\text{m}^{-1}$. The
drag slows the updraughts without increasing the mixing between the
fluids which makes the solutions less like the resolved simulations.
Although drag is known to be an important term in the momentum equations
for buoyant thermals and plumes \cite<e.g.,>{RC15}, the drag is related
to mixing with downdraught air which is accounted for in the entrainment
term of the momentum equation. So adding a separate term from drag
risks double counting and slows the plume too much. 

If we include pressure difference between fluids with $\gamma=10^{4}\text{m}^{2}\text{s}^{-1}$but
omit entrainment ($S_{ij}=0$) (second row of figure \ref{fig:multiFluidSingleColumn})
the fluids move past each other but there is an unrealistic discontinuity
with no fluid 1 below the buoyant fluid and very little falling air
at the lowest height of the rising fluid. With \change[HW]{single}{one} column and
two fluids, all air must rise in one fluid and sink in the other.
Continuity does not allow for any other solution. Pressure gradients
can accelerate or decelerate this flow but as the model is set up,
with no transfers between fluids, no fluid can change direction. It
is therefore essential to have transfers between fluids.

The other entrainment option is the commonly used fractional entrainment
rate, $\varepsilon=0.2/r_{c}$. This is used combined with pressure
differences between fluids in the middle row of figure \ref{fig:multiFluidSingleColumn-bad}.
This combination produces smooth solutions but the updraught is too
weak and too much is entrained into fluid 1. Using this entrainment,
the updraught will entrain more and more air until $\sigma_{1}=1$.
The $S_{ij}=-\nabla\cdot\mathbf{u}_{i}$ model gives much more accurate
entrainment and detrainment for this test case using conditional averaging
based on $w$.

Two alternative models for estimating the buoyancy of the fluid transferred
between updraught and downdraught have been tested. The results in
the fourth row if figure \ref{fig:multiFluidSingleColumn} assume
that the fluid transferred has zero buoyancy in order to keep the
positively buoyant air in fluid one and the negatively buoyant air
in fluid 0. Thus when zero buoyancy air leaves fluid one (the updraught),
the mean buoyancy of fluid one increases. This leads to very high
buoyancy in fluid one which is not present in the resolved simulation.
The results in the bottom row of figure \ref{fig:multiFluidSingleColumn}
use $b_{ij}^{T}=\frac{1}{2}\left(b_{0}+b_{1}\right)$ following \citeA{TEB19}
so that the fluid transferred is influenced by the fluid it is moving
towards as well as where it has come from. This again leads to very
large buoyancy in fluid one and also negative buoyancy in fluid zero
which should not occur for this test case. These simple models reinforce
the idea that the buoyancy of the fluid transferred should depend
on knowledge of sub-grid-scale variability of $b$ within each fluid
\textendash{} these simple assumptions can lead to unrealistic behaviour.
The best model tested is $b_{ij}^{T}=b_{i}$ which assumes that the
fluid transferred takes the mean properties with it.

This section has demonstrated the value of using \change[HW]{single}{one} column,
multi-fluid model to simulate a buoyant rising bubble with a single
updraught fluid and a single downdraught fluid. Transfers between
the fluids have been successfully modelled using entrainment set by
divergence giving realistic updraught fractions. Entrainment calculated
as the reciprocal of plume width was not successful. The pressure
difference between the fluids has also been represented by divergence
with a coefficient close to that expected from dimensional analysis.
Including drag between the fluids did not improve simulations. Two
models of transferring non-mean properties between fluids were tested
but neither was plausible. There are clearly discrepancies between
the single-fluid resolved rising bubble and the two fluid \change[HW]{single}{one} column
rising bubble but we do not want to over fit the multi-fluid model
to one, dry, two dimensional test case.

\subsection{Radiative-Convective Equilibrium (RCE)}

A two-dimensional, dry radiative convective equilibrium test case
is devised to mimic some properties of atmospheric convection, in
particular the difficulty resolving the flow at coarse resolution.
The domain is 160km wide, 10km tall and is resolved by 640 cells in
the horizontal and 40 in the vertical ($\Delta x=\Delta z=250$m).
The top and bottom boundaries are zero velocity and the lateral boundaries
are periodic. A heat flux of $h=10^{-3}\text{m}^{2}\text{s}^{-3}$
is imposed at the bottom boundary leading to a boundary condition
of $\partial b/\partial z=-h/\alpha\text{s}^{-2}$ where $\alpha=100\ \text{m}^{2}\text{s}^{-1}$
is the buoyancy diffusivity. The top boundary has $\partial b/\partial z=0$.
Diffusion is applied to the momentum equation with a coefficient $\nu=70.7\ \text{m}^{2}\text{s}^{-1}$
so as to give a Plank constant of $0.707$. Uniform cooling of $-1\times10^{-7}\text{m}\text{s}^{-3}$
is applied to the domain to maintain equilibrium.

The fluid is initially stationary with $b=0$. In order to quickly
and reproducibly initialise instability, $b=10^{-4}\text{m}^{2}\text{s}^{-1}$
is imposed in a square of side length 2000m at the centre in the $x$
direction and at the ground. The simulation is run using a time step
of $5\ \text{s}$. A quasi-steady, choatic state is reached after
about $3\times10^{4}\text{s}$ and the simulation is run for $2\times10^{5}\text{s}$
and conditional averages are calculated over the final $10^{5}$s.

\subsubsection{Single-Fluid Solutions}

This test case is designed to have strong updraughts in narrow plumes
and weak descent elsewhere to mimic atmospheric convection but without
the complication of moisture, phase changes and three spatial dimensions.
A snapshot of the buoyancy, vertical velocity and pressure of the
radiative-convective equilibrium test case at $2\times10^{5}\text{s}$
are shown in figure \ref{fig:RCE_resolved} showing intense, narrow
updraughts. The buoyant air at the ground rises in narrow plumes,
accelerating due to buoyancy and pressure gradients then decelerating
due to pressure gradients before reaching the top. The plumes spread
out and the sinking air is a mixture of warm and cold with similar
pressure gradients in the rising and falling air, accelerating then
decelerating the flow so as to maintain continuity. 

\noindent 
\begin{figure}
\includegraphics[width=1\textwidth]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/200000/bw}

Buoyancy ($\text{m}\text{s}^{-2}$) \includegraphics[width=0.8\textwidth]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/legends/bw_b}

\includegraphics[width=1\textwidth]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/200000/Pw}

Pressure ($\text{m}^{2}\text{s}^{-2}$) \includegraphics[width=0.8\textwidth]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/legends/Pw_P}

\caption{Buoyancy, vertical velocity and pressure at $t=2\times10^{5}\ \text{s}$
of the resolved radiative-convective equilibrium test case. Vertical
velocity contours are black every 0.5m/s with negative contours dashed
and the zero contour dotted. The domain is 10km high and 160km wide
and the z-direction is stretched a factor of 2 in the plots. \label{fig:RCE_resolved}}
\end{figure}

Horizontal averages conditioned on $w$ and time averaged every 1000s
between $10^{5}\ \text{s}$ and $2\times10^{5}\ \text{s}$ are shown
in the top row of figure \ref{fig:RCE_singleColumn}. The rising and
falling volume fractions, $\sigma_{1}$ and $\sigma_{0}$, remain
close to $\frac{1}{2}$ throughout the depth. The rising plumes look
narrow in figure \ref{fig:RCE_resolved} but there are wide regions
of slowly rising air around the plume cores. The entrained rising
cool air and warm air sinking that has hit the model top mean that
the rising and falling air have similar average buoyancy away from
the ground. The ascending air gradually accelerates towards the middle
of the domain then decelerates towards the model top. At the ground
the acceleration is forced by buoyancy and away from the ground the
acceleration is controlled by pressure gradients. The descending air
mean velocity is close to equal and opposite to the ascending air,
as expected since $\sigma_{1}=0.5$.

\subsubsection{Results of the Two-fluid, \change[HW]{Single}{One} Column Simulations}

The two fluid model is used to simulate the RCE test case in \change[HW]{single}{one}
column of 40 cells with zero buoyancy gradient at the top and a buoyancy
gradient of $10^{-5}\text{s}^{-2}$ at the ground for both fluids
and uniform radiative cooling. The two fluids are initialised using
the time mean conditional horizontal averages from the single-fluid
resolved simulation. The entrainment model $S_{ij}=-\nabla\cdot\mathbf{u}_{i}$
is used for all simulations to account for transfers throughout the
domain to represent cloud base mass flux (at the bottom boundary),
cloud top detrainment and lateral entrainment. $\gamma$ is set from
equation (\ref{eq:gammaDimAnal}) using the depth of the super adiabatic
layer as the length scale ($L=800\text{m}$) and the buoyancy scale
$B=L\ \partial b/\partial z=8\times10^{-3}\text{m}\text{s}^{-2}$
giving $\gamma=2000\text{m}^{2}\text{s}^{-1}$. A simulation using
$S_{ij}=-\nabla\cdot\mathbf{u}_{i}$, no drag and $b_{ij}^{T}=b_{i}$
is shown in the second row of figure \ref{fig:RCE_singleColumn}.
The entrainment model $S_{ij}=-\nabla\cdot\mathbf{u}_{i}$ keeps $\sigma_{i}$
at about 0.5 throughout the depth, as in the resolved simulation,
with entrainment in the lower half of the domain ($S_{01}>0$) and
detrainment in the upper half ($S_{10}>0$), where the air decelerates
towards the top. The \change[HW]{single}{one} column model reproduces the super-adiabatic
layer near the ground and the near uniform buoyancy away from the
ground but the buoyancy difference between the fluids is too large.
The updraught and downdraught velocities are captured well. The pressure
differences between fluids are too large which is consistent with
the over estimated buoyancy difference between fluids. 

Results of a simulations using $b_{ij}^{T}=\frac{1}{2}(b_{0}+b_{1})$
is shown in the bottom row of figure \ref{fig:RCE_singleColumn}.
This model of the buoyancy of the transferred fluid is bad; it leads
to strong cooling in fluid zero near the ground due to the large transfers.
It is more accurate to assume that fluids take their mean properties
when transferred, $b_{ij}^{T}=b_{i}$. 

\begin{figure}
\setlength\tabcolsep{0.5pt}%
\begin{tabular}{ccccc}
$\sigma$ & $\sigma S\ (\text{s}^{-1})$  & $b\ (\text{m}\ \text{s}^{-2})$ & $w\ (\text{m}\ \text{s}^{-1})$ & $P\ (\text{m}^{2}\text{s}^{-2})$\tabularnewline
\multicolumn{5}{c}{Horizontal averages of the resolved RCE test case}\tabularnewline
\includegraphics[scale=0.7]
{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/timeMean_w/sigmaMean}
&
\includegraphics[scale=0.7]
{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/uniformTransfer_Pi4e3_w/0/massTransfer}
&
\includegraphics[scale=0.7]
{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/timeMean_w/bMean}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/timeMean_w/wMean} & \includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/hiRes_wide/timeMean_w/PMean}
\tabularnewline
\multicolumn{5}{c}{\change[HW]{Single}{One} column with $S_{ij}=-\nabla\cdot\mathbf{u}_{i}$ and
$b_{ij}^{T}=b_{i}$, $\gamma=4\times10^{3}\text{m}^{2}\text{s}^{-1}$
}\tabularnewline
\includegraphics[scale=0.7]
{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_w/100000/sigma_1}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_w/100000/massTransfer}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_w/100000/b_1}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_w/100000/u_1}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_w/100000/P_1}
\tabularnewline
\multicolumn{5}{c}{\change[HW]{Single}{One} column  with $S_{ij}=-\nabla\cdot\mathbf{u}_{i}$ and
$b_{ij}^{T}=\frac{1}{2}\left(b_{i}+b_{j}\right)$, $\gamma=2\times10^{3}\text{m}^{2}\text{s}^{-1}$
}\tabularnewline
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_bT05_w/100000/sigma_1}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_bT05_w/100000/massTransfer}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_bT05_w/100000/b_1}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_bT05_w/100000/u_1}
&
\includegraphics[scale=0.7]{/home/hilary/OpenFOAM/hilary-7/run/hilary/RCE/Boussinesq/singleColumn/divTransfer_Pi4e3_divSigmau_bT05_w/100000/P_1}\tabularnewline
\end{tabular}

\caption{Results of the RCE simulations. The top row shows horizontal averages
of the resolved case between $t=10^{5}\text{s}$ and $2\times10^{5}\text{s}$. The
bottom two rows show results of the \change[HW]{single}{one} column multi-fluid model
after $10^{4}\ \text{s}$. \label{fig:RCE_singleColumn}}
\end{figure}


\section{Summary, Conclusions and Further Work}

This paper presents solutions of the multi-fluid Boussinesq equations
for convection, reproducing aspects of highly resolved dry convection
at coarse horizontal resolution. Two test cases are used to validate
the multi-fluid model. The first is a Boussinesq version of the well
known two dimensional dry rising bubble of \citeA{BF02} and the second
is a dry two dimensional version of radiative-convective equilibrium
with heating at the ground and uniform radiative cooling. High resolution
single-fluid simulations are conditionally averaged based on the sign
of vertical velocity ($w$) in order to create rising and falling
fluids which each have their own mean buoyancy, velocity and pressure.
The two-fluid, \change[HW]{single}{one} column Boussinesq model reproduces mean vertical
heat and mass transport of these test cases. 

The multi-fluid Boussinesq equations can have divergence in each fluid
while the divergence averaged over all fluids is 
\change[HW]{zero}
{constrained to be zero following the single-fluid Boussinesq equations.}
A model is proposed and validated for the pressure difference between the rising
and falling fluids based on the divergence of each fluid. The use
of a different pressure for each fluid is not only realistic but also
leads to stable solutions of the multi-fluid equations. 

Conditionally averaging the high resolution solutions based on $w$
leads to convecting and non-convecting regions with area fractions,
$\sigma_{i}$, which are approximately uniform with height. Models
for entrainment and detrainment into and out of convecting regions
must clearly be consistent with the definition of the convecting region.
We propose a model for entrainment and detrainment based on divergence
that leads to excellent agreement with $\sigma$ from the high resolution
solutions. We also test a more conventional fractional entrainment
rate based on the reciprocal of the plume width which leads to unrealistic
convecting area fractions. 

A set of unknowns in the multi-fluid equations are the properties
of the fluid that are transferred from one fluid to another. An obvious
first guess would be that fluid takes its mean buoyancy and velocity
with it when it is transferred. However sub-grid-scale variability
of each fluid means that we expect that the most buoyant fluid will
be transferred to the rising fluid or the fluid with the largest vertical
velocity will be transferred to the rising fluid and vice versa. An
accurate estimate of these would depend on knowledge of the sub-grid-scale
variability of each fluid which we do not have. Instead we assume
that the fluid transferred in each direction has zero vertical velocity
which is consistent with our conditional averaging. We have tested
three models for the buoyancy of the fluid transferred. The most successful
is to assume that the fluid takes its mean buoyancy with it. Assuming
that the buoyancy of the transferred fluid is an average of the buoyancy
of both fluids can lead to unrealistically large or small, unbounded
buoyancies. Similarly, if we assume that one fluid has negative buoyancy
and the other positive buoyancy and we transfer fluid of zero buoyancy,
then unbounded buoyancy can occur. A better model of the buoyancy
of the fluid transferred would rely on more information the sub-grid-scale
variability.

\change[HW]{Single}{One} column multi-fluid modelling with moisture has already been
demonstrated by \citeA{TEB19} 
\add[HW]{and two dimensional simulations of the multi-fluid Euler equations by \protect\citeA{WM19} }.
Two important next steps are to simulate
convection in the grey zone (where it is partially resolved) and to
represent sub-grid-scale variability within each fluid by solving
multi-fluid prognostic equations for turbulent kinetic energy and
other moments of the sub-grid variability. These can be used to inform
cloud base mass flux (since only the most buoyant fluid will transfer
from the stable environment to the buoyant plume) and inform models
of the properties of the fluid that is transferred. This will lead
to a unified parameterisation of turbulence and convection and will
take multi-fluid modelling of convection beyond existing paradigms. 

\acknowledgments

Many thanks to John Thuburn and Chris Holloway for valuable discussions.
Thanks to the NERC/Met Office Paracon project. We acknowledge funding
from the Circle-A and RevCon Paracon projects NE/N013743/1 and NE/N013735/1. All the code can be downloaded from \url{https://github.com/AtmosFOAM/AtmosFOAM-multiFluid} and the test cases from \url{https://github.com/AtmosFOAM/hilaryRun}.

\bibliography{numerics}

\end{document}
